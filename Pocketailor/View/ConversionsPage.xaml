<phone:PhoneApplicationPage
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:Pocketailor_View="clr-namespace:Pocketailor.View"
	xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" 
	xmlns:ec="clr-namespace:Microsoft.Expression.Interactivity.Core;assembly=Microsoft.Expression.Interactions"
    xmlns:Ads="clr-namespace:MC.Phone.Ads;assembly=MC.Phone.Ads"
    xmlns:Controls="clr-namespace:Pocketailor.View.Controls"
    xmlns:SampleData="clr-namespace:Expression.Blend.SampleData.SampleDataSource" 
    x:Class="Pocketailor.View.ConversionsPage"
    SupportedOrientations="Portrait" Orientation="Portrait"
    mc:Ignorable="d"
	shell:SystemTray.BackgroundColor="{StaticResource SystemTrayBGColor}"
	shell:SystemTray.ForegroundColor="{StaticResource SystemTrayFGColor}"
    shell:SystemTray.IsVisible="True">
	
	<toolkit:TransitionService.NavigationInTransition>
    <toolkit:NavigationInTransition>
        <toolkit:NavigationInTransition.Backward>
            <toolkit:TurnstileTransition Mode="BackwardIn"/>
        </toolkit:NavigationInTransition.Backward>
        <toolkit:NavigationInTransition.Forward>
            <toolkit:TurnstileTransition Mode="ForwardIn"/>
        </toolkit:NavigationInTransition.Forward>
    </toolkit:NavigationInTransition>
</toolkit:TransitionService.NavigationInTransition>
<toolkit:TransitionService.NavigationOutTransition>
    <toolkit:NavigationOutTransition>
        <toolkit:NavigationOutTransition.Backward>
            <toolkit:TurnstileTransition Mode="BackwardOut"/>
        </toolkit:NavigationOutTransition.Backward>
        <toolkit:NavigationOutTransition.Forward>
            <toolkit:TurnstileTransition Mode="ForwardOut"/>
        </toolkit:NavigationOutTransition.Forward>
    </toolkit:NavigationOutTransition>
</toolkit:TransitionService.NavigationOutTransition>

	

	<phone:PhoneApplicationPage.Resources>
		<Pocketailor_View:StringToUpper x:Key="StringToUpper"/>
		<Pocketailor_View:StringOrDefaultOnEmpty x:Key="StringOrDefaultOnEmpty"/>
		<Pocketailor_View:SelectedConversionToBGImage x:Key="SelectedConversionToBGImage"/>
		<Pocketailor_View:SelectedConversionToPageTitleString x:Key="SelectedConversionToPageTitleString"/>
		<Pocketailor_View:BoolToStrings x:Key="BoolToStrings"/>
		<Pocketailor_View:IsHiddenToVisibility x:Key="IsHiddenToVisibility"/>
		<Pocketailor_View:BoolToOpacity x:Key="BoolToOpacity"/>
    
		<DataTemplate x:Key="ConversionsByRegionSubItemTemplate">
			<Controls:ConversionValueButton ClothingSize="{Binding FormattedValue}" IsHidden="{Binding IsHidden}" RetailerName="{Binding Name}"  Visibility="{Binding IsVisible, Converter={StaticResource BoolToVisibility}}" toolkit:TiltEffect.IsTiltEnabled="True" Margin="24,0,0,0" />
		</DataTemplate>


		<Style x:Key="ListBoxItemStyle" TargetType="ListBoxItem">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="HorizontalContentAlignment" Value="Stretch"/>
			<Setter Property="VerticalContentAlignment" Value="Top"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListBoxItem">
						<Border x:Name="LayoutRoot" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" Background="{TemplateBinding Background}" HorizontalAlignment="{TemplateBinding HorizontalAlignment}" VerticalAlignment="{TemplateBinding VerticalAlignment}">
							<VisualStateManager.VisualStateGroups>
								<VisualStateGroup x:Name="CommonStates">
									<VisualState x:Name="Normal"/>
									<VisualState x:Name="MouseOver"/>
									<VisualState x:Name="Disabled">
										<Storyboard>
											<ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Background" Storyboard.TargetName="LayoutRoot">
												<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource TransparentBrush}"/>
											</ObjectAnimationUsingKeyFrames>
											<DoubleAnimation Duration="0" To=".5" Storyboard.TargetProperty="Opacity" Storyboard.TargetName="ContentContainer"/>
										</Storyboard>
									</VisualState>
								</VisualStateGroup>
								<VisualStateGroup x:Name="SelectionStates">
									<VisualState x:Name="Unselected"/>
									<VisualState x:Name="Selected">
										<Storyboard>
											<ObjectAnimationUsingKeyFrames Storyboard.TargetProperty="Foreground" Storyboard.TargetName="ContentContainer">
												<DiscreteObjectKeyFrame KeyTime="0" Value="{StaticResource PhoneAccentBrush}"/>
											</ObjectAnimationUsingKeyFrames>
										</Storyboard>
									</VisualState>
								</VisualStateGroup>
							</VisualStateManager.VisualStateGroups>
							<ContentControl x:Name="ContentContainer" ContentTemplate="{TemplateBinding ContentTemplate}" Content="{TemplateBinding Content}" Foreground="{TemplateBinding Foreground}" HorizontalContentAlignment="{TemplateBinding HorizontalContentAlignment}" Margin="{TemplateBinding Padding}" VerticalContentAlignment="{TemplateBinding VerticalContentAlignment}"/>
						</Border>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

		<Style x:Key="SubListBoxStyle" TargetType="ListBox">
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListBox">
						<ItemsPresenter/>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>
	
		<DataTemplate x:Key="ConversionsByRegionItemTemplate">
			<Grid>
				<Grid.RowDefinitions>
					<RowDefinition Height="Auto"/>
					<RowDefinition Height="Auto"/>
				</Grid.RowDefinitions>
				<TextBlock Grid.Row="0" Margin="12,0,0,0" Text="{Binding Name, Converter={StaticResource StringToUpper}}" Style="{StaticResource SubTitleTextBoxStyle}"/>
				<ListBox Grid.Row="1" ItemsSource="{Binding Conversions}"  Style="{StaticResource SubListBoxStyle}" ItemTemplate="{StaticResource ConversionsByRegionSubItemTemplate}" ItemContainerStyle="{StaticResource ListBoxItemStyle}"/>
			</Grid>
		</DataTemplate>
    
  
  <SampleData:LongListSampleData x:Key="LongListSampleDataInstance" d:IsDataSource="True"/>

	</phone:PhoneApplicationPage.Resources>
  
	<phone:PhoneApplicationPage.Background>
		<StaticResource ResourceKey="PageBGColor"/>
	</phone:PhoneApplicationPage.Background>


	<phone:PhoneApplicationPage.FontFamily>
		<StaticResource ResourceKey="PhoneFontFamilyNormal"/>
	</phone:PhoneApplicationPage.FontFamily>
	<phone:PhoneApplicationPage.FontSize>
		<StaticResource ResourceKey="PhoneFontSizeNormal"/>
	</phone:PhoneApplicationPage.FontSize>
	<phone:PhoneApplicationPage.Foreground>
		<StaticResource ResourceKey="PhoneForegroundBrush"/>
	</phone:PhoneApplicationPage.Foreground>


	<d:DataContext>
		<Binding Source="{StaticResource SampleDataSource}"/>
	</d:DataContext>

	<phone:PhoneApplicationPage.ApplicationBar>
		<shell:ApplicationBar IsVisible="True" IsMenuEnabled="True" ForegroundColor="{StaticResource ApplicationBarFGColor}" BackgroundColor="{StaticResource ApplicationBarBGColor}">
		    <shell:ApplicationBarIconButton IconUri="/Images/appbar.globe.png" Text="change region"></shell:ApplicationBarIconButton>
			<shell:ApplicationBar.MenuItems>
                <shell:ApplicationBarMenuItem x:Name="showHiddenAppBarMenuItem" Text="show hidden retailers" Click="showHiddenAppBarMenuItem_Click" />
            </shell:ApplicationBar.MenuItems>
		</shell:ApplicationBar>
	</phone:PhoneApplicationPage.ApplicationBar>
	

<!--LayoutRoot is the root grid where all page content is placed-->
	<Grid x:Name="LayoutRoot" Margin="0,6,0,0" Background="{StaticResource PageBGColor}">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="80"/>
		</Grid.RowDefinitions>

		<Grid x:Name="headerGrid"  Grid.Row="0" Margin="0" VerticalAlignment="Top">
			<Grid.RowDefinitions>
				<RowDefinition Height="2*"/>
				<RowDefinition Height="1*"/>
			</Grid.RowDefinitions>
			<Image x:Name="bgImage" Grid.RowSpan="2" VerticalAlignment="Top" Source="{Binding SelectedConversionType, Converter={StaticResource SelectedConversionToBGImage}}" Margin="2,0,-2,0"/>
			
			<Grid x:Name="titleBarGrid"  Grid.Row="0" Margin="0" Background="Black" VerticalAlignment="Top">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<StackPanel x:Name="logoContainer" Orientation="Horizontal" VerticalAlignment="Top" Grid.Column="0" Margin="12,0,0,0">
					<Image Source="/Images/SmallLogo.png" Margin="0,3,2,0" Stretch="None"/>
					<TextBlock Foreground="{StaticResource PivotTitleColor}">
						<Run Text="POCKETAILOR"/>
					</TextBlock>
				</StackPanel>
				<TextBlock Grid.Column="1" x:Name="profileName" FontSize="22" TextAlignment="Right" Margin="0,0,12,0" Text="{Binding SelectedProfile.Name, ConverterParameter=[no name];, Converter={StaticResource StringOrDefaultOnEmpty}}"/>
			</Grid>
			
			<Grid x:Name="pageTitleContainerGrid" Background="{StaticResource ImgOverlayColor}" VerticalAlignment="Top" Grid.Row="1">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<TextBlock x:Name="pageTitleTextBlock" Grid.Column="0" TextWrapping="Wrap" Text="{Binding SelectedConversionType, Converter={StaticResource SelectedConversionToPageTitleString}}" FontFamily="{StaticResource ScriptFont}" Margin="24,0,0,0" FontSize="53.333" Foreground="{StaticResource PageTxtColor}" />
				<TextBlock x:Name="regionTextBlock" Grid.Column="1" HorizontalAlignment="Right" VerticalAlignment="Center" Margin="0,0,24,0" FontSize="26.667" Text="{Binding SelectedRegion}"/>
			</Grid>
			
		</Grid>

		<!--
		<ListBox Grid.Row="1"   ItemTemplate="{StaticResource ConversionsByRegionItemTemplate}" ItemsSource="{Binding ConversionsByRegion}" ItemContainerStyle="{StaticResource ListBoxItemStyle}"/>
		-->

		
		<toolkit:LongListSelector x:Name="conversionsLongListSelector" Grid.Row="1" IsFlatList="False"
                                  d:DataContext="{StaticResource LongListSampleDataInstance}" ItemsSource="{Binding GroupedConversions}" >
			<toolkit:LongListSelector.Resources>
				<DataTemplate x:Key="groupHeaderTemplate">
					<!-- The header for the group e.g. letter -->
					<Border Background="{StaticResource TileBGColor}" Width="62" Height="62" Margin="24,12,23,5" HorizontalAlignment="Left">
						<TextBlock Text="{Binding Key}" Foreground="{StaticResource PageTxtColor}" FontSize="48" Padding="6" HorizontalAlignment="Left" VerticalAlignment="Center"/>
					</Border>
				</DataTemplate>
				<DataTemplate x:Key="groupFooterTemplate">
					<!-- The footer for each group -->
					<!--
					
					-->
				</DataTemplate>
				<ItemsPanelTemplate x:Key="groupItemsPanelTemplate">
					<!-- The selection dialog container -->
					<toolkit:WrapPanel></toolkit:WrapPanel>
				</ItemsPanelTemplate>
				<DataTemplate x:Key="groupItemTemplate">
					<!-- The individual item in the selector dialog -->
					<Grid>
						<TextBlock>A</TextBlock>
					</Grid>
				</DataTemplate>
				<Style x:Key="bigSmallBtnStyle" TargetType="Button">
					<Setter Property="Template">
						<Setter.Value>
							<ControlTemplate TargetType="Button">
								<Grid>
									<TextBlock FontSize="24" HorizontalAlignment="Left" Text="{TemplateBinding Content}" Foreground="{StaticResource SubTitleColor}" FontFamily="Segoe WP" />
								</Grid>
							</ControlTemplate>
						</Setter.Value>
					</Setter>
				</Style>
				<DataTemplate x:Key="itemTemplate">
					<!-- Applied to each item -->
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto"/>
							<RowDefinition Height="Auto"/>
						</Grid.RowDefinitions>
						<Grid x:Name="conversionGrid" Margin="24,0,0,6" Tap="conversionGrid_Tap">
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="Auto"></ColumnDefinition>
								<ColumnDefinition Width="*"></ColumnDefinition>
							</Grid.ColumnDefinitions>
							<TextBlock Grid.Column="0" Text="{Binding BrandName}" Foreground="{StaticResource PageTxtColor}" FontSize="26.667"></TextBlock>
							<TextBlock Grid.Column="1" Text="{Binding FormattedValue}" Foreground="{StaticResource SubTitleColor}" FontSize="26.667" Margin="5,0,0,0"></TextBlock>
						</Grid>
						<Grid x:Name="adjustmentContainer" Margin="24,0,24,24" Visibility="Visible" Grid.Row="1">
							
							<Grid.ColumnDefinitions>
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="*" />
								<ColumnDefinition Width="Auto" />
							</Grid.ColumnDefinitions>
							<Button x:Name="tooBigBtn" Content="too big" Grid.Column="0" Style="{StaticResource bigSmallBtnStyle}" Tap="tooBigBtn_Tap"/>
							<Button x:Name="tooSmallBtn" Content="too small" Grid.Column="1"  Style="{StaticResource bigSmallBtnStyle}" Tap="tooSmallBtn_Tap"/>
							<Button x:Name="hideBrandBtn" Content="hide brand" Grid.Column="2" HorizontalAlignment="Right" Margin="0" Tap="hideBrandBtn_Tap">
								<Button.Resources>
									<Style x:Key="ButtonStyle1" TargetType="Button">
										<Setter Property="Template">
											<Setter.Value>
												<ControlTemplate TargetType="Button">
													<Grid>
														<Border Background="{StaticResource SubTitleColor}" Padding="12,4">
															<TextBlock Text="{TemplateBinding Content}" Foreground="{StaticResource AccentColor}" FontFamily="Segoe WP" FontSize="21.333"  />
														</Border>
													</Grid>
												</ControlTemplate>
											</Setter.Value>
										</Setter>
									</Style>
								</Button.Resources>
								<Button.Style>
									<StaticResource ResourceKey="ButtonStyle1"/>
								</Button.Style>
							</Button>

							
						</Grid>
					</Grid>
				</DataTemplate>
				<DataTemplate x:Key="listFooterTemplate">
					<!-- Bottom of whole control -->
					<Grid/>
				</DataTemplate>
				<DataTemplate x:Key="listHeaderTemplate">
					<!-- Top of whole control -->
					<Grid/>
				</DataTemplate>
			</toolkit:LongListSelector.Resources>

			<toolkit:LongListSelector.ListHeaderTemplate>
				<StaticResource ResourceKey="listHeaderTemplate"/>
			</toolkit:LongListSelector.ListHeaderTemplate>
			<toolkit:LongListSelector.ListFooterTemplate>
				<StaticResource ResourceKey="listFooterTemplate"/>
			</toolkit:LongListSelector.ListFooterTemplate>
			<toolkit:LongListSelector.ItemTemplate>
				<StaticResource ResourceKey="itemTemplate"/>
			</toolkit:LongListSelector.ItemTemplate>
			<!--
			<toolkit:LongListSelector.GroupItemTemplate>
				<StaticResource ResourceKey="groupItemTemplate"/>
			</toolkit:LongListSelector.GroupItemTemplate>
			<toolkit:LongListSelector.GroupItemsPanel>
				<StaticResource ResourceKey="groupItemsPanelTemplate"/>
			</toolkit:LongListSelector.GroupItemsPanel>
			-->
			<toolkit:LongListSelector.GroupFooterTemplate>
				<StaticResource ResourceKey="groupFooterTemplate"/>
			</toolkit:LongListSelector.GroupFooterTemplate>
			<toolkit:LongListSelector.GroupHeaderTemplate>
				<StaticResource ResourceKey="groupHeaderTemplate"/>
			</toolkit:LongListSelector.GroupHeaderTemplate>
		</toolkit:LongListSelector>

		<Border Grid.Row="2"   Width="480" Height="80" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0" BorderThickness="1" BorderBrush="White">
			<TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
				<Run Text="Advert here"/>
			</TextBlock>
		</Border>
		<!--
		<Ads:AdControl Grid.Row="2"  Content="AdControl" VerticalAlignment="Bottom"/>
		-->


	</Grid>
	

</phone:PhoneApplicationPage>