<phone:PhoneApplicationPage
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:phone="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone"
    xmlns:shell="clr-namespace:Microsoft.Phone.Shell;assembly=Microsoft.Phone"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
	xmlns:Pocketailor_View="clr-namespace:Pocketailor.View"
	xmlns:Pocketailor_ViewModel="clr-namespace:Pocketailor.ViewModel"
	xmlns:toolkit="clr-namespace:Microsoft.Phone.Controls;assembly=Microsoft.Phone.Controls.Toolkit"
    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" 
	xmlns:ec="clr-namespace:Microsoft.Expression.Interactivity.Core;assembly=Microsoft.Expression.Interactions"
    xmlns:Ads="clr-namespace:MC.Phone.Ads;assembly=MC.Phone.Ads"
    xmlns:Controls="clr-namespace:Pocketailor.View.Controls"
    xmlns:SampleData="clr-namespace:Expression.Blend.SampleData.SampleDataSource" 
    x:Class="Pocketailor.View.ConversionsPage"
    SupportedOrientations="Portrait" Orientation="Portrait"
	toolkit:TiltEffect.IsTiltEnabled="True"
    mc:Ignorable="d"
	shell:SystemTray.BackgroundColor="{StaticResource SystemTrayBGColor}"
	shell:SystemTray.ForegroundColor="{StaticResource SystemTrayFGColor}"
    shell:SystemTray.IsVisible="True">
	
	<toolkit:TransitionService.NavigationInTransition>
    <toolkit:NavigationInTransition>
        <toolkit:NavigationInTransition.Backward>
            <toolkit:TurnstileTransition Mode="BackwardIn"/>
        </toolkit:NavigationInTransition.Backward>
        <toolkit:NavigationInTransition.Forward>
            <toolkit:TurnstileTransition Mode="ForwardIn"/>
        </toolkit:NavigationInTransition.Forward>
    </toolkit:NavigationInTransition>
</toolkit:TransitionService.NavigationInTransition>
<toolkit:TransitionService.NavigationOutTransition>
    <toolkit:NavigationOutTransition>
        <toolkit:NavigationOutTransition.Backward>
            <toolkit:TurnstileTransition Mode="BackwardOut"/>
        </toolkit:NavigationOutTransition.Backward>
        <toolkit:NavigationOutTransition.Forward>
            <toolkit:TurnstileTransition Mode="ForwardOut"/>
        </toolkit:NavigationOutTransition.Forward>
    </toolkit:NavigationOutTransition>
</toolkit:TransitionService.NavigationOutTransition>

	

	<phone:PhoneApplicationPage.Resources>
		<Pocketailor_View:StringToNextString x:Key="StringToNextString"/>
		<Pocketailor_View:VisibilityToOpposite x:Key="VisibilityToOpposite"/>
		<Pocketailor_View:BoolToNotCheckBox x:Key="BoolToNotCheckBox"/>
		<Pocketailor_View:StringToUpper x:Key="StringToUpper"/>
		<Pocketailor_View:StringOrDefaultOnEmpty x:Key="StringOrDefaultOnEmpty"/>
		<Pocketailor_View:SelectedConversionToBGImage x:Key="SelectedConversionToBGImage"/>
		<Pocketailor_View:SelectedConversionToPageTitleString x:Key="SelectedConversionToPageTitleString"/>
		<Pocketailor_View:BoolToStrings x:Key="BoolToStrings"/>
		<Pocketailor_View:IsHiddenToVisibility x:Key="IsHiddenToVisibility"/>
		<Pocketailor_View:BoolToOpacity x:Key="BoolToOpacity"/>
    
   
		<Pocketailor_ViewModel:ViewModelLocator x:Key="ViewModelInstanceLocator" />
	
	
  
  <SampleData:LongListSampleData x:Key="LongListSampleDataInstance" d:IsDataSource="True"/>

		<Style x:Key="noScrollListBoxStyle" TargetType="ListBox">
			<Setter Property="Background" Value="Transparent"/>
			<Setter Property="Foreground" Value="{StaticResource PhoneForegroundBrush}"/>
			<Setter Property="ScrollViewer.HorizontalScrollBarVisibility" Value="Disabled"/>
			<Setter Property="ScrollViewer.VerticalScrollBarVisibility" Value="Auto"/>
			<Setter Property="BorderThickness" Value="0"/>
			<Setter Property="BorderBrush" Value="Transparent"/>
			<Setter Property="Padding" Value="0"/>
			<Setter Property="Template">
				<Setter.Value>
					<ControlTemplate TargetType="ListBox">
						<ItemsPresenter/>
					</ControlTemplate>
				</Setter.Value>
			</Setter>
		</Style>

	</phone:PhoneApplicationPage.Resources>
  
	<phone:PhoneApplicationPage.Background>
		<StaticResource ResourceKey="PageBGColor"/>
	</phone:PhoneApplicationPage.Background>


	<phone:PhoneApplicationPage.FontFamily>
		<StaticResource ResourceKey="PhoneFontFamilyNormal"/>
	</phone:PhoneApplicationPage.FontFamily>
	<phone:PhoneApplicationPage.FontSize>
		<StaticResource ResourceKey="PhoneFontSizeNormal"/>
	</phone:PhoneApplicationPage.FontSize>
	<phone:PhoneApplicationPage.Foreground>
		<StaticResource ResourceKey="PhoneForegroundBrush"/>
	</phone:PhoneApplicationPage.Foreground>


	<d:DataContext>
		<Binding Source="{StaticResource SampleDataSource}"/>
	</d:DataContext>

	<!--
	<phone:PhoneApplicationPage.ApplicationBar>
		<shell:ApplicationBar IsVisible="True" IsMenuEnabled="True" ForegroundColor="{StaticResource ApplicationBarFGColor}" BackgroundColor="{StaticResource ApplicationBarBGColor}">
			<shell:ApplicationBar.MenuItems>
				<shell:ApplicationBarMenuItem x:Name="changeRegionApplicationBarMenuItem" IsEnabled="True" Text="change region" Click="changeRegionApplicationBarMenuItem_Click"/>
			</shell:ApplicationBar.MenuItems>
		    <shell:ApplicationBarIconButton x:Name="editHiddenBrandsApplicationBarIconButton" IconUri="/Images/AppBar/appbar.edit.png" Text="edit hidden brands" Click="editHiddenBrandsApplicationBarIconButton_Click"></shell:ApplicationBarIconButton>
		</shell:ApplicationBar>
	</phone:PhoneApplicationPage.ApplicationBar>
-->

<!--LayoutRoot is the root grid where all page content is placed-->
	<Grid x:Name="LayoutRoot" Margin="0" Background="{StaticResource PageBGColor}">
		<Grid.RowDefinitions>
			<RowDefinition Height="Auto"/>
			<RowDefinition Height="*"/>
			<RowDefinition Height="80"/>
		</Grid.RowDefinitions>

		<Grid x:Name="headerGrid"  Grid.Row="0" Margin="0" VerticalAlignment="Top">
			<Grid.RowDefinitions>
				<RowDefinition Height="2*"/>
				<RowDefinition Height="1*"/>
			</Grid.RowDefinitions>


			<Image x:Name="bgImage" 
				Grid.RowSpan="3" 
				VerticalAlignment="Top" Source="{Binding SelectedConversionType, Converter={StaticResource SelectedConversionToBGImage}}" Margin="0"/>
			
			<Grid x:Name="titleBarGrid"  
				Grid.Row="0" 
				Margin="0" Background="Black" VerticalAlignment="Top">
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<StackPanel x:Name="logoContainer" Orientation="Horizontal" VerticalAlignment="Top" Grid.Column="0" Margin="12,0,0,0">
					<Image Source="/Images/SmallLogo.png" Margin="0,3,2,0" Stretch="None"/>
					<TextBlock Foreground="{StaticResource PivotTitleColor}">
						<Run Text="POCKETAILOR"/>
					</TextBlock>
				</StackPanel>
				<TextBlock Grid.Column="1" x:Name="profileName" FontSize="22" TextAlignment="Right" Margin="0,0,12,0" Text="{Binding SelectedProfile.Name, ConverterParameter=[no name];, Converter={StaticResource StringOrDefaultOnEmpty}}"/>
			</Grid>
			
			<Grid x:Name="pageTitleContainerGrid" 
				Grid.Row="1"
				Background="#8ABE2D" VerticalAlignment="Top" >
				<Grid.ColumnDefinitions>
					<ColumnDefinition Width="Auto"/>
					<ColumnDefinition Width="*"/>
				</Grid.ColumnDefinitions>
				<TextBlock x:Name="pageTitleTextBlock" Grid.Column="0" TextWrapping="Wrap" Text="{Binding SelectedConversionType, Converter={StaticResource SelectedConversionToPageTitleString}}" FontFamily="{StaticResource ScriptFont}" Margin="24,0,0,0" FontSize="53.333" Foreground="{StaticResource PageTxtColor}" />
				<Button x:Name="regionChangeBtn" Content="{Binding SelectedRegionString}" Grid.Column="1" HorizontalAlignment="Right" Margin="0,0,24,0" VerticalAlignment="Center">
					<Button.Resources>
						<Style x:Key="ButtonStyle1" TargetType="Button">
							<Setter Property="Template">
								<Setter.Value>
									<ControlTemplate TargetType="Button">
										<Grid>
											<TextBlock Text="{TemplateBinding Content}" FontFamily="Segoe WP" FontSize="32" />
										</Grid>
									</ControlTemplate>
								</Setter.Value>
							</Setter>
							<Setter Property="FontSize" Value="26.667"/>
						</Style>
					</Button.Resources>
					<Button.Projection>
						<PlaneProjection/>
					</Button.Projection>
					<Button.Foreground>
						<StaticResource ResourceKey="PageTxtColor"/>
					</Button.Foreground>
					<i:Interaction.Triggers>
						<i:EventTrigger EventName="Click">
							<ec:NavigateToPageAction TargetPage="/View/EditRegionPage.xaml"/>
						</i:EventTrigger>
					</i:Interaction.Triggers>
					<Button.Style>
						<StaticResource ResourceKey="ButtonStyle1"/>
					</Button.Style>
				</Button>
			</Grid>
			<Button x:Name="dismissHiddenBranEditBtn" 
				Grid.Row="1"
				Content="Dismiss hidden brands" HorizontalAlignment="Right" Height="50" Width="320" Tap="dismissHiddenBranEditBtn_Tap" VerticalAlignment="Bottom">
				<Button.Resources>
					<Style x:Key="ButtonStyle1" TargetType="Button">
						<Setter Property="Template">
							<Setter.Value>
								<ControlTemplate TargetType="Button">
									<Grid x:Name="quitEditHiddenBrandsContainer" Background="{StaticResource TileBGColor}" Visibility="Visible">
										<TextBlock Text="{TemplateBinding Content}" HorizontalAlignment="Center" VerticalAlignment="Center" FontFamily="Segoe WP" FontSize="24" />
									</Grid>
								</ControlTemplate>
							</Setter.Value>
						</Setter>
						<Setter Property="FontSize" Value="26.667"/>
					</Style>
				</Button.Resources>
				<Button.Foreground>
					<StaticResource ResourceKey="PageTxtColor"/>
				</Button.Foreground>
				<Button.Visibility>
					<Binding Converter="{StaticResource BoolToVisibility}" Path="ShowBlacklistedConversions"/>
				</Button.Visibility>
				<Button.Style>
					<StaticResource ResourceKey="ButtonStyle1"/>
				</Button.Style>
			</Button>
				
			
		</Grid>

	
		
		<toolkit:LongListSelector x:Name="conversionsLongListSelector" 
								Grid.Row="1" IsFlatList="False"
                                d:DataContext="{StaticResource LongListSampleDataInstance}" 
								ItemsSource="{Binding GroupedConversions}" 
								DisplayAllGroups="True" Background="Transparent">
			<toolkit:LongListSelector.Resources>
				<DataTemplate x:Key="groupHeaderTemplate">
					<!-- The header for the group e.g. letter -->

					<Border Background="Transparent" Margin="12,6,0,6" Visibility="{Binding HasItems, Converter={StaticResource BoolToVisibility}}" HorizontalAlignment="Left">
                                <Border Background="{StaticResource TileBGColor}" 	
                                        Padding="8,0,0,0" 
										Width="62" Height="62" 				 
                                        HorizontalAlignment="Left"
										>
                                    <TextBlock Text="{Binding Key}" 
                                               Foreground="{StaticResource PageTxtColor}" 
                                               FontSize="48"
                                               FontFamily="{StaticResource PhoneFontFamilySemiLight}"
                                               HorizontalAlignment="Left"
                                               VerticalAlignment="Bottom"/>
                                </Border>
                            </Border>
					
					
				</DataTemplate>
				<DataTemplate x:Key="groupFooterTemplate">
					<!-- The footer for each group -->
					<!--
					
					-->
				</DataTemplate>
				<ItemsPanelTemplate x:Key="groupItemsPanelTemplate">
					<!-- The selection dialog container -->
					<toolkit:WrapPanel Orientation="Horizontal"></toolkit:WrapPanel>
				</ItemsPanelTemplate>
				<DataTemplate x:Key="groupItemTemplate">
					<!-- The individual item in the selector dialog -->
					<Border Background="Black" Margin="6" IsHitTestVisible="{Binding HasItems}">
						<Border Background="{StaticResource TileBGColor}" Width="99" Height="99"  
							 Opacity="{Binding HasItems, ConverterParameter=TrueIsOpaque, Converter={StaticResource BoolToOpacity}}">
							<TextBlock Text="{Binding Key}" Foreground="{StaticResource PageTxtColor}" FontSize="48" 
							Margin="8,0,0,0" HorizontalAlignment="Left" VerticalAlignment="Bottom"
				 />
						</Border>
					</Border>
				</DataTemplate>

				<DataTemplate x:Key="itemTemplate" toolkit:TiltEffect.SuppressTilt="True">
					<!-- Applied to each item -->
						<Controls:ConversionResultsBtn 
							Margin="12,0,24,4" 
							BtnClothingSize="{Binding FormattedValue}" 
							BtnBrandName="{Binding BrandName}" 
							BtnIsBlacklisted="{Binding IsBlacklisted, Mode=TwoWay}" 
							BtnShowBlacklisted="{Binding AppViewModel.ShowBlacklistedConversions, Source={StaticResource ViewModelInstanceLocator}}"
						 />
						
					</DataTemplate>
				<DataTemplate x:Key="listFooterTemplate">
					<!-- Bottom of whole control -->
					<Grid/>
				</DataTemplate>
				<DataTemplate x:Key="listHeaderTemplate">
					<!-- Top of whole control -->
					<Grid>
						<Grid.RowDefinitions>
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
							<RowDefinition Height="Auto" />
						</Grid.RowDefinitions>

						<Controls:AboutButton x:Name="editHiddenBrandsBtn" 
							Grid.Row="0"
							Margin="12,12,12,0"
							VerticalAlignment="Top" TitleText="{Binding AppViewModel.ShowBlacklistedConversions, ConverterParameter=Dismiss hidden brands|Edit hidden brands, Converter={StaticResource BoolToStrings}, Source={StaticResource ViewModelLocator}}"
							IconImage="/Images/AppBar/appbar.edit.png" Tap="editHiddenBrandsBtn_Tap_1" />
						
						<Controls:AboutButton x:Name="showKeyMeasurementsBtn" 
							Grid.Row="1"
							Margin="12,12,12,12" 
							VerticalAlignment="Top" TitleText="Show key measurements" 
							IconImage="/Images/AppBar/appbar.pocketailor.tape.png">
							<i:Interaction.Triggers>
								<i:EventTrigger EventName="Tap">
									<ec:ChangePropertyAction x:Name="showMeasurementListBoxChangePropertyAction" TargetName="measurementsListBox" PropertyName="Visibility" Value="{Binding Visibility, Converter={StaticResource VisibilityToOpposite}, ElementName=measurementsListBox}"/>
								</i:EventTrigger>
								<i:EventTrigger EventName="Tap">
									<ec:ChangePropertyAction x:Name="changeTextChangePropertyAction" PropertyName="TitleText" Value="{Binding TitleText, ConverterParameter=Show key measurements|Hide key measurements, Converter={StaticResource StringToNextString}, ElementName=showKeyMeasurementsBtn}"/>
								</i:EventTrigger>
							</i:Interaction.Triggers>
						</Controls:AboutButton>
						
						<!--
						<TextBlock
							Grid.Row="0" 
							Text="KEY MEASUREMENTS" Style="{StaticResource SubTitleTextBoxStyle}"
							Margin="12,12,0,8" />
						-->
						<ListBox x:Name="measurementsListBox"
							Grid.Row="2"
							Visibility="Collapsed"
							ItemsSource="{Binding AppViewModel.ConversionMeasurements, Source={StaticResource ViewModelLocator}}" 
							Style="{StaticResource noScrollListBoxStyle}"
							Margin="12,0,12,8">
							<ListBox.Resources>
								<DataTemplate x:Key="DataTemplate1">
									<Grid x:Name="otherUnitMeasurmentGrid" Margin="0,0,0,12">
										<i:Interaction.Triggers>
											<i:EventTrigger EventName="Tap">
												<ec:ChangePropertyAction TargetName="otherMeasurementUnitsListBox" PropertyName="Visibility" Value="{Binding Visibility, Converter={StaticResource VisibilityToOpposite}, ElementName=otherMeasurementUnitsListBox}"/>
											</i:EventTrigger>
										</i:Interaction.Triggers>
										<Grid.ColumnDefinitions>
											<ColumnDefinition Width="1*" />
											<ColumnDefinition Width="1*" />
										</Grid.ColumnDefinitions>
										<Grid.RowDefinitions>
											<RowDefinition Height="Auto" />
											<RowDefinition Height="Auto" />
										</Grid.RowDefinitions>
										<TextBlock 
											Grid.Column="0" Grid.Row="0"
											FontSize="{StaticResource PhoneFontSizeLarge}" Foreground="{StaticResource PageTxtColor}"
											Text="{Binding Name, FallbackValue=Height}" HorizontalAlignment="Right" />
										<TextBlock 
											Grid.Column="1" Grid.Row="0"
											FontSize="{StaticResource PhoneFontSizeLarge}" Foreground="{StaticResource SubTitleColor}"
											Text="{Binding FormattedValue, FallbackValue=5 ft. 8 in.}" Margin="6,0,0,0" HorizontalAlignment="Left" />
										<ListBox
											x:Name="otherMeasurementUnitsListBox"
											Grid.Column="1" Grid.Row="1"
											Visibility="Collapsed"
											ItemsSource="{Binding OtherUnitFormattedValues}"
											>
											<ListBox.Resources>
												<DataTemplate x:Key="DataTemplate2">
													<Grid>
														<TextBlock 
															Text="{Binding FallbackValue=170 cm.}" 
															Foreground="{StaticResource SubTitleColor}"
															Margin="6,0,0,0" FontSize="25.333" />
													</Grid>
												</DataTemplate>
											</ListBox.Resources>
											<ListBox.Style>
												<StaticResource ResourceKey="noScrollListBoxStyle"/>
											</ListBox.Style>
											<ListBox.ItemTemplate>
												<StaticResource ResourceKey="DataTemplate2"/>
											</ListBox.ItemTemplate>
											
											
										</ListBox>
									</Grid>
								</DataTemplate>
							</ListBox.Resources>
							<ListBox.ItemTemplate>
								<StaticResource ResourceKey="DataTemplate1"/>
							</ListBox.ItemTemplate>
						</ListBox>
						<!--
						<TextBlock 
							Grid.Row="2"
							Text="CONVERSIONS" Style="{StaticResource SubTitleTextBoxStyle}"
							Margin="12,0,0,8" />
						-->
					</Grid>
					
				</DataTemplate>
			</toolkit:LongListSelector.Resources>

			<toolkit:LongListSelector.ListHeaderTemplate>
				<StaticResource ResourceKey="listHeaderTemplate"/>
			</toolkit:LongListSelector.ListHeaderTemplate>
			<toolkit:LongListSelector.ListFooterTemplate>
				<StaticResource ResourceKey="listFooterTemplate"/>
			</toolkit:LongListSelector.ListFooterTemplate>
			<toolkit:LongListSelector.ItemTemplate>
				<StaticResource ResourceKey="itemTemplate"/>
			</toolkit:LongListSelector.ItemTemplate>
			
			<toolkit:LongListSelector.GroupItemTemplate>
				<StaticResource ResourceKey="groupItemTemplate"/>
			</toolkit:LongListSelector.GroupItemTemplate>
			<toolkit:LongListSelector.GroupItemsPanel>
				<StaticResource ResourceKey="groupItemsPanelTemplate"/>
			</toolkit:LongListSelector.GroupItemsPanel>
			
			<toolkit:LongListSelector.GroupFooterTemplate>
				<StaticResource ResourceKey="groupFooterTemplate"/>
			</toolkit:LongListSelector.GroupFooterTemplate>
			<toolkit:LongListSelector.GroupHeaderTemplate>
				<StaticResource ResourceKey="groupHeaderTemplate"/>
			</toolkit:LongListSelector.GroupHeaderTemplate>
		</toolkit:LongListSelector>

		<!--
		<Border Grid.Row="2"   Width="480" Height="80" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0" BorderThickness="1" BorderBrush="White">
			<TextBlock HorizontalAlignment="Center" VerticalAlignment="Center">
				<Run Text="Advert here"/>
			</TextBlock>
		</Border>
		-->
		<Ads:AdControl x:Name="AdBasic"
				Grid.Row="2"
		        FallbackAdProviderName="AdDuplex"
                IsTest="True"
                xmlns:Ads="clr-namespace:MC.Phone.Ads;assembly=MC.Phone.Ads"
                xmlns:PubCenter="clr-namespace:MC.Phone.Ads.PubCenter;assembly=MC.Phone.Ads.PubCenter"
                xmlns:Smaato="clr-namespace:MC.Phone.Ads.Smaato;assembly=MC.Phone.Ads.Smaato"
                xmlns:MobFox="clr-namespace:MC.Phone.Ads.MobFox;assembly=MC.Phone.Ads.MobFox"
                xmlns:AdMob="clr-namespace:MC.Phone.Ads.AdMob;assembly=MC.Phone.Ads.AdMob"
                xmlns:Provider="clr-namespace:MC.Phone.Ads.Provider;assembly=MC.Phone.Ads"
                xmlns:AdDuplex="clr-namespace:MC.Phone.Ads.AdDuplex;assembly=MC.Phone.Ads.AdDuplex">
			<Ads:AdControl.AdProviders>
				<Provider:GenericAdProviderForXaml 
					OfflineContent="Ads/Ad.xaml"
					XamlUri="http://lassiv.com/pocketailor/Ad.xaml?AppId={0}&amp;Country={1}" />
				<Provider:NoneAdProvider />
				<AdDuplex:AdDuplexAdProvider App="39175" />
				<AdMob:AdMobAdProvider AdUnit="a151711df5e2459" />
				<MobFox:MobFoxAdProvider Publisher="d8a881615506a0eaadcc6ddc6a20e2d3" />
				<Smaato:SmaatoAdProvider AdSpace="65777443"
											Publisher="923869561" />
				<PubCenter:PubCenterAdProvider Application="1ac16da8-a326-47b2-b652-4ada4d3a1d3b"
												AdUnit="126598" />
			<!--InnerActive is not really suitable for the Ad Rotation because it doesn't have any events to react on.-->
			<!--<InnerActive:InnerActiveAdProvider App="" />-->
		</Ads:AdControl.AdProviders>
		<Ads:AdControl.AdProviderStrategy>
			<Strategy:RemoteAdProviderStrategy xmlns:Strategy="clr-namespace:MC.Phone.Ads.Strategy;assembly=MC.Phone.Ads"
                                        LocalProviderSettingsUri="Ads/AdSettings.xml"
                                        RemoteProviderSettingsUri="http://www.lassiv.com/pocketailor/misc/AdSettings.xml" />
		</Ads:AdControl.AdProviderStrategy>
    

</Ads:AdControl>

	</Grid>
	

</phone:PhoneApplicationPage>